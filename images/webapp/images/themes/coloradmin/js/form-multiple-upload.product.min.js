var handleJqueryFileUpload = function (paramNames,productId) {
      $("#addAdditionalImagesForm").fileupload({
        autoUpload: false,
        disableImageResize: /Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),
        maxFileSize: 5e6,
        acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
        paramName:paramNames,
        limitConcurrentUploads:8,
        limitMultiFileUploads:3,
        completed: function (e, data) {
            var params = data.paramName;
            for(var i=0;i<params.length;i++) {
                paramNames.splice($.inArray(params[i], paramNames), 1);
            }
            console.log(paramNames)
            $("#addAdditionalImagesForm").fileupload("option","paramName",paramNames);
            ajaxUpdateAreas(',search-results,/catalog/control/ProductContentList,productId='+productId+'&VIEW_SIZE_1=5&VIEW_INDEX_1=0');
        },
        destroyed:function(e,data){
            //console.log(data)
            if(data.paramname) {
                paramNames.push(data.paramname);
            }
            console.log(paramNames);
            ajaxUpdateAreas(',search-results,/catalog/control/ProductContentList,productId='+productId+'&VIEW_SIZE_1=5&VIEW_INDEX_1=0');
        }
    })
    $("#addAdditionalImagesForm").fileupload("option", "redirect", window.location.href.replace(/\/[^\/]*$/, "/cors/result.html?%s"));

    if ($.support.cors) {
        $.ajax({type: "HEAD"}).fail(function () {
            $('<div class="alert alert-danger"/>').text("Upload server currently unavailable - " + new Date).appendTo("#addAdditionalImagesForm")
        })
    }
    //$("#addAdditionalImagesForm").addClass("fileupload-processing");
    /*$.ajax({
        url: $("#addAdditionalImagesForm").fileupload("option", "url"),
        dataType: "json",
        context: $("#addAdditionalImagesForm")[0]
    }).always(function () {
        $(this).removeClass("fileupload-processing")
    }).done(function (e) {
        $(this).fileupload("option", "done").call(this, $.Event("done"), {result: e});
        console.log(e)
    })*/
};
var FormMultipleUpload = function () {
    "use strict";
    return {
        init: function (paramNames,productId) {
            handleJqueryFileUpload(paramNames,productId)
        }
    }
}()